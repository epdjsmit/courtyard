var RepeatableCustomize=function(a){var b=this,c=jQuery,d=a.container,e=a.params.fields,f=JSON.parse(a.params.value);b.getData=function(){var a=c(".form-data",d),b=c("input, textarea, select",a).serialize();return JSON.stringify(b)},b.rename=function(){c(".list-repeatable li",d).each(function(a){var b=c(this);c("input, textarea, select",b).each(function(){var b=c(this),d=b.attr("data-repeat-name")||void 0;"undefined"!=typeof d&&(d=d.replace(/__i__/g,a),b.attr("name",d))})})};var g=wp.media({title:wp.media.view.l10n.addMedia,multiple:!1,library:{type:"image"}});if(g.on("close",function(){g.state().get("selection")}),b.handleMedia=function(a){c(".item-media",a).each(function(){var a=c(this);c(".remove-button",a).on("click",function(b){b.preventDefault(),c(".image_id, .image_url",a).val(""),c(".thumbnail-image",a).html(""),c(".current",a).removeClass("show").addClass("hide"),c(this).hide(),c(".upload-button",a).text(c(".upload-button",a).attr("data-add-txt")),c(".image_id",a).trigger("change")}),c(".upload-button",a).on("click",function(){var b=c(this);g.on("select",function(){var d=g.state().get("selection").first().toJSON();c(".image_id",a).val(d.id);var e,f;f=d.url,c(".current",a).removeClass("hide").addClass("show"),c(".image_url",a).val(f),e='<img src="'+f+'" alt="">',c(".thumbnail-image",a).html(e),c(".remove-button",a).show(),c(".image_id",a).trigger("change"),b.text(b.attr("data-change-txt"))}),g.open()})})},b.colorPicker=function(a){c(".color-field",a).wpColorPicker({change:function(a,c){b.updateValue()}})},b.actions=function(d){if(c(".widget .widget-action, .widget .repeat-control-close, .widget-title",d).click(function(a){var b=c(".widget",d);return b.hasClass("explained")?c(".widget-inside",b).slideUp(200,"linear",function(){c(".widget-inside",b).removeClass("show").addClass("hide"),b.removeClass("explained")}):c(".widget-inside",b).slideDown(200,"linear",function(){c(".widget-inside",b).removeClass("hide").addClass("show"),b.addClass("explained")}),!1}),"undefined"!=typeof a.params.live_title_id){var e=c("[data-live-id='"+a.params.live_title_id+"']",d).eq(0).val();""==e&&(e="[Untitled]"),"undefined"!=typeof a.params.title_format&&""!==a.params.title_format&&(e=a.params.title_format.replace("[live_title]",e)),c(".widget-title .live-title",d).text(e),d.on("keyup","[data-live-id='"+a.params.live_title_id+"']",function(){var b=c(this).val();""==b&&(b="[Untitled]"),"undefined"!=typeof a.params.title_format&&""!==a.params.title_format&&(b=a.params.title_format.replace("[live_title]",b)),c(".widget-title .live-title",d).text(b)})}d.on("click",".repeat-control-remove",function(a){a.preventDefault(),d.remove(),b.rename(),b.updateValue()})},b.repeaterTemplate=_.memoize(function(){var a,b={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(c){return(a=_.template(d.find(".repeatable-js-template").first().html(),null,b))(c)}}),b.template=b.repeaterTemplate(),b.newItem=function(){c(".add-new-repeat-item",a.container).click(function(){var d=c(b.template(e));c(".list-repeatable",a.container).append(d),b["int"](d),b.actions(d),b.updateValue()})},b["int"]=function(a){b.rename(),b.colorPicker(a),b.handleMedia(a)},c(".list-repeatable li").each(function(){b.actions(c(this))}),b.updateValue=function(){var a=b.getData();c("[data-hidden-value]",d).val(a),c("[data-hidden-value]",d).trigger("change")},c(".list-repeatable",d).sortable({handle:".widget-title",containment:".customize-control-repeatable",update:function(a,c){b.rename(),b.updateValue()}}),f.length)for(var h,i,j=0;j<f.length;j++){if(h=c.extend(!0,{},a.params.fields),i=f[j],f[j])for(var k in i)i.hasOwnProperty(k)&&i.hasOwnProperty(k)&&(h[k].value=i[k]);var l=c(b.template(h));c(".list-repeatable",d).append(l),b["int"](l),b.actions(l)}b.newItem(),b["int"](d),c(".list-repeatable",d).on("keyup change","input, select, textarea",function(a){b.updateValue()})};!function(a){a.controlConstructor.repeatable=a.Control.extend({ready:function(){var a=this;new RepeatableCustomize(a,jQuery)}})}(wp.customize),jQuery(document).ready(function(a){a(".controls#pt-img-container li img").click(function(){a(".controls#pt-img-container li").each(function(){a(this).find("img").removeClass("pt-radio-img-selected")}),a(this).addClass("pt-radio-img-selected")})}),jQuery(document).ready(function(a){var b;a(document.body).on("click",".custom_media_upload",function(c){var d=a(this),e=d.parent().find(".custom_media_input"),f=d.parent().find(".custom_media_preview");c.preventDefault(),b=wp.media.frames.media_file=wp.media({title:d.data("choose"),button:{text:d.data("update")},states:[new wp.media.controller.Library({title:d.data("choose"),library:wp.media.query({type:"image"})})]}),b.on("select",function(){var a=b.state().get("selection").first().toJSON();e.val(a.url),f.css({display:"none"}).find("img").remove(),f.css({display:"block"}).append('<img src="'+a.url+'" style="max-width:100%">')}),b.open()}),a(document.body).on("click",".delete_media_image",function(){var b=a(this).closest(".media-uploader");return b.find(".custom_media_input").val(""),b.find(".custom_media_preview").css({display:"none"}).find("img").remove(),!1}),a("input.custom_media_input").each(function(){var b=a(this).val(),c=a(this).siblings(".custom_media_preview");""!==b&&(c.find("img.custom_media_preview_default").remove(),c.css({display:"block"}).append('<img src="'+b+'" style="max-width:100%">'))})}),jQuery(document).ready(function(a){function b(b){b.find(".pt-color-picker").wpColorPicker({change:_.throttle(function(){a(this).trigger("change")},3e3)})}function c(a,c){b(c)}a(document).on("widget-added widget-updated",c),a(document).ready(function(){a("#widgets-right .widget:has(.pt-color-picker)").each(function(){b(a(this))})})});